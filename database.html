<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„É°„Ç´„É°„Ç´„Åª„Çä„Åª„Çä | ÂåñÁü≥Âõ≥Èëë</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">

    <style>
        /* CSS„Å´Â§âÊõ¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì */
        :root {
            --primary: #5D4037;
            --accent: #FFAB00; 
            --pop: #FF7043;
            --bg-color: #EFEBE9;
            --shelf-bg: #8D6E63;
            --shelf-shadow: #5D4037;
            --text-dark: #3E2723;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-dark);
            margin: 0; padding: 0; line-height: 1.8;
            padding-top: 60px;
            overflow-x: hidden;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px 15px 80px; box-sizing: border-box; }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .site-header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000;
            padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }
        
        .header-logo { 
            display: flex; align-items: center; 
            text-decoration: none; cursor: pointer; 
        }
        .header-logo img {
            height: 36px;
            width: auto;
            margin-right: 8px;
        }
        .header-logo span {
            font-weight: 900; 
            color: var(--primary); 
            font-size: 1.1rem;
        }

        /* „Éí„Éº„É≠„Éº„Ç®„É™„Ç¢ */
        .hero-area { text-align: center; padding: 30px 0 20px; }
        .hero-copy {
            display: block; font-size: 1.5rem; font-weight: 900; color: var(--pop);
            margin-bottom: 20px; letter-spacing: 0.05em; text-shadow: 2px 2px 0 #fff;
            line-height: 1.4;
        }
        
        .hero-logo-box {
            display: inline-block; padding: 10px 30px; border-radius: 15px;
            background: #fff; box-shadow: 6px 6px 0 var(--accent);
            border: 4px solid var(--primary); transform: rotate(-2deg);
            margin-bottom: 15px;
        }
        .hero-logo-box h1 { margin: 0; font-size: 2.2rem; color: var(--primary); letter-spacing: 0.05em; line-height: 1.2; }

        /* Ê£ö„Ç®„É™„Ç¢ */
        .shelf-container {
            background: var(--shelf-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 10px 0 var(--shelf-shadow);
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        .shelf-container::before {
            content: "COLLECTION";
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            background: #4E342E; color: #fff; padding: 2px 15px; font-size: 0.8rem; border-radius: 10px; font-weight: bold;
            z-index: 5;
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px 10px;
        }

        .fossil-item {
            background: #fff;
            border-radius: 8px;
            aspect-ratio: 1 / 1;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid #D7CCC8;
            transition: transform 0.2s;
            overflow: visible; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (hover: hover) {
            .fossil-item:hover {
                transform: scale(1.05);
                z-index: 100;
                border-color: var(--pop);
            }
        }
        .fossil-item:active { transform: scale(0.95); }

        .fossil-item.locked { background: #ECEFF1; }
        .fossil-item.locked img {
            filter: brightness(0) opacity(0.2);
            transform: scale(0.8);
        }
        .fossil-item.locked::after {
            content: "?"; position: absolute; font-size: 2rem;
            color: rgba(0,0,0,0.1); font-weight: 900;
            pointer-events: none;
        }

        .fossil-item.unlocked {
            border-color: var(--accent);
            background: #FFF8E1;
        }
        .fossil-item.unlocked img {
            animation: pukaPuka 3s ease-in-out infinite;
        }
        
        .fossil-item.selected {
            border-color: var(--pop);
            box-shadow: 0 0 0 4px rgba(255, 112, 67, 0.3);
            background: #fff;
        }

        .fossil-item.coming-soon { background: #D7CCC8; cursor: default; }
        .coming-text { font-size: 0.7rem; font-weight: bold; color: #fff; text-align: center; opacity: 0.7; }
        .fossil-img { width: 70%; height: 70%; object-fit: contain; position: relative; z-index: 1; }

        @keyframes pukaPuka {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.05); }
        }

        @keyframes flashEffect {
            0% { background-color: #fff; box-shadow: 0 0 50px #fff; }
            100% { background-color: #FFF8E1; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        }
        .just-unlocked { animation: flashEffect 0.6s ease-out forwards; }

        /* „Ç≠„É©„Ç≠„É© */
        .sparkle-particle {
            position: absolute; top: 50%; left: 50%; width: 15px; height: 15px;
            background: radial-gradient(circle, #fff 20%, #FFD700 100%);
            border-radius: 50%; pointer-events: none; z-index: 999;
            transform: translate(-50%, -50%) scale(0); opacity: 0;
            animation: sparkleFly 0.8s ease-out forwards;
        }
        @keyframes sparkleFly {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(180deg); opacity: 0; }
        }

        /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó */
        .tooltip-box {
            position: absolute; bottom: 105%; left: 50%; transform: translateX(-50%) scale(0.8);
            opacity: 0; pointer-events: none;
            background: rgba(255, 255, 255, 0.98); color: #333;
            padding: 8px; border-radius: 8px; width: 140px; text-align: center;
            font-size: 0.75rem; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 3px solid var(--pop);
            z-index: 200; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: center bottom;
        }
        .tooltip-box::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -8px;
            border-width: 8px; border-style: solid; border-color: var(--pop) transparent transparent transparent;
        }
        .fossil-item:hover .tooltip-box { transform: translateX(-50%) scale(1); opacity: 1; bottom: 110%; }


        /* --- Ë©≥Á¥∞„Ç®„É™„Ç¢ --- */
        .detail-section {
            display: none;
            margin-top: 30px;
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 4px solid var(--primary);
            animation: slideUp 0.5s ease-out;
            text-align: center;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .detail-title {
            font-size: 1.8rem; margin: 0 0 20px; color: var(--primary);
            border-bottom: 2px dashed #D7CCC8; padding-bottom: 10px;
        }
        .detail-image-box {
            background: #FFF8E1; border-radius: 10px; padding: 20px;
            display: inline-block; margin-bottom: 20px;
            border: 2px solid var(--accent);
        }
        .detail-img-large {
            max-width: 100%; height: auto; max-height: 200px;
            filter: drop-shadow(0 4px 0 rgba(0,0,0,0.1));
            animation: pukaPuka 4s ease-in-out infinite;
        }

        .detail-table {
            width: 100%; border-collapse: collapse; margin-bottom: 20px;
            font-size: 0.9rem;
        }
        .detail-table th {
            background: var(--primary); color: #fff; padding: 8px;
            border: 1px solid var(--primary); width: 30%;
        }
        .detail-table td {
            background: #fff; padding: 8px; border: 1px solid #D7CCC8;
            color: var(--text-dark); font-weight: bold;
        }

        .detail-desc-text {
            text-align: left; background: #EFEBE9; padding: 15px;
            border-radius: 8px; font-size: 0.9rem; line-height: 1.8;
            border-left: 5px solid var(--pop);
        }

        /* --- UI„Éë„Éº„ÉÑ --- */
        .scroll-top-btn {
            position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px;
            background: var(--pop); color: #fff; border: none; border-radius: 50%;
            font-size: 1.5rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 900; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s, transform 0.2s;
        }
        .scroll-top-btn.show { opacity: 1; pointer-events: auto; }
        .scroll-top-btn:active { transform: scale(0.9); }

        /* --- „Éá„Éê„ÉÉ„Ç∞„É¢„Éº„ÉâÔºà„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞Ôºâ --- */
        .debug-area {
            display: none; 
            position: fixed; bottom: 20px; left: 20px; width: 320px;
            text-align: center; padding: 0;
            background: #fff; border: 2px solid #546E7A; border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 3000; overflow: hidden;
        }
        .debug-header {
            background: #546E7A; color: #fff; padding: 8px;
            cursor: move; font-weight: bold; font-size: 0.9rem;
            user-select: none;
        }
        .debug-content { padding: 15px; }
        .debug-btn { 
            margin: 3px; padding: 6px 10px; border: none; background: #78909C; color: #fff; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
        }
        .debug-reset { background: #E65100; font-weight:bold; width: 100%; margin: 5px 0; }
        .debug-close { background: #d32f2f; margin-top: 10px; width: 100%; }

        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px;
            font-size: 0.85rem; z-index: 4000; opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; }

        footer { background: #4E342E; color: #D7CCC8; padding: 20px; text-align: center; font-size: 0.7rem; margin-top: 40px; }
    </style>
</head>
<body>

<header class="site-header">
    <a href="#" class="header-logo" id="top-logo">
        <img src="image/lab.png" alt="„É©„Éú„ÅÆ„Ç¢„Ç§„Ç≥„É≥">
        <span>„É°„Ç´„É°„Ç´„Åª„Çä„Åª„Çä</span>
    </a>
</header>

<div class="container">
    <div class="hero-area">
        <div class="hero-logo-box"><h1>ÂåñÁü≥Âõ≥Èëë</h1></div><br>
        <span class="hero-copy">Êéò„ÇäÂá∫„ÅõÔºÅÊú™Êù•„ÅÆ„Ç®„É≥„Ç∏„Éã„Ç¢ÔºÅ</span>
        <span class="concept">„Åô„Åπ„Å¶„ÅÆÂåñÁü≥„ÇíÈõÜ„ÇÅ„Çà„ÅÜÔºÅ</span>
    </div>

    <div class="shelf-container">
        <div class="collection-grid" id="grid-container"></div>
    </div>

    <div id="detail-section" class="detail-section">
        <h2 id="dino-info-name" class="detail-title">ÊÅêÁ´ú„ÅÆÂêçÂâç</h2>
        
        <div class="detail-image-box">
            <img id="dino-info-img" src="" class="detail-img-large" alt="">
        </div>

        <table class="detail-table">
            <tr>
                <th>ÂêçÂâç„ÅÆÁî±Êù•</th>
                <td id="dino-info-name-origin">-</td>
            </tr>
            <tr>
                <th>Â§ß„Åç„Åï</th>
                <td id="dino-info-size">-</td>
            </tr>
            <tr>
                <th>Èáç„Åï</th>
                <td id="dino-info-weight">-</td>
            </tr>
            <tr>
                <th>ÂàÜÈ°û</th>
                <td id="dino-info-class">-</td>
            </tr>
            <tr>
                <th>ÊôÇ‰ª£</th>
                <td id="dino-info-era">-</td>
            </tr>
            <tr>
                <th>Áî£Âá∫ÂõΩ</th>
                <td id="dino-info-origin">-</td>
            </tr>
        </table>

        <div id="dino-info-desc" class="detail-desc-text">
            „Åì„Åì„Å´Ë©≥„Åó„ÅÑË™¨Êòé„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ
        </div>
    </div>

    <div class="debug-area" id="debug-section">
        <div class="debug-header" id="debug-drag-handle">üõ† ÈñãÁô∫ËÄÖ„É¢„Éº„Éâ (Move Me)</div>
        <div class="debug-content">
            <div style="margin-bottom:5px;">
                <button class="debug-btn" onclick="simulateNFC('ammonite')">„Ç¢„É≥„É¢</button>
                <button class="debug-btn" onclick="simulateNFC('trilobite')">‰∏âËëâËô´</button>
                <button class="debug-btn" onclick="simulateNFC('spino')">„Çπ„Éî„Éé</button>
                <button class="debug-btn" onclick="simulateNFC('fukuiraptor')">„Éï„ÇØ„Ç§</button>
                <button class="debug-btn" onclick="simulateNFC('trex')">„ÉÜ„Ç£„É©„Éé</button>
            </div>
            <button class="debug-btn debug-reset" onclick="resetCollection()">‚Üª Âõ≥Èëë„Çí„É™„Çª„ÉÉ„Éà</button>
            <button class="debug-btn debug-close" onclick="disableDebugMode()">ÁµÇ‰∫Ü„Åô„Çã</button>
        </div>
    </div>
</div>

<div id="toast" class="toast"></div>
<button id="scroll-top-btn" class="scroll-top-btn">‚ñ≤</button>

<footer>
    <span id="copyright-trigger" style="user-select: none;">¬© 2026 MECHAMECHA HORIHORI</span>
</footer>

<audio id="sfx-sparkle" src="sparkle.mp3" preload="auto"></audio>

<script>
    /**
     * „Éá„Éº„ÇøÂÆöÁæ© (Data Model)
     * ÁîªÂÉè„Éë„Çπ„Çí„Åô„Åπ„Å¶ 'image/' „Å´‰øÆÊ≠£
     */
    const fossils = [
        { 
            id: 'ammonite', name: '„Ç¢„É≥„É¢„Éä„Ç§„Éà', img: 'image/ammonite.jpg', // ‰øÆÊ≠£: image/
            hint: ['„Åê„Çã„Åê„Çã„Åó„Å¶„ÅÑ„Çã‚Ä¶', 'Êµ∑„Å´„ÅÑ„Åü„Çâ„Åó„ÅÑ'], 
            desc: ['„Äê„Ç¢„É≥„É¢„Éä„Ç§„Éà„Äë', '„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË¶ã„Çã'],
            data: {
                nameOrigin: '„Ç¢„É¢„É≥Ôºà„Ç®„Ç∏„Éó„Éà„ÅÆÁ•ûÔºâ„ÅÆËßí',
                size: 'Êï∞cm „Äú 2m',
                weight: 'Êï∞g „Äú Êï∞ÂçÅkg',
                class: 'È†≠Ë∂≥È°ûÔºà„Ç§„Ç´„Éª„Çø„Ç≥„ÅÆ‰ª≤ÈñìÔºâ',
                era: '„Éá„Éú„É≥Á¥Ä „Äú ÁôΩ‰∫úÁ¥Ä',
                origin: '‰∏ñÁïå‰∏≠',
                longDesc: 'Ê∏¶Â∑ª„ÅçÁä∂„ÅÆÊÆª„ÇíÊåÅ„Å£„Å¶„ÅÑ„ÅüÊµ∑„ÅÆÁîü„ÅçÁâ©„Å†„Çà„ÄÇÊÅêÁ´ú„ÅåÁîü„Åç„Å¶„ÅÑ„ÅüÊôÇ‰ª£„Çà„Çä„Åö„Å£„Å®Ââç„Åã„Çâ„ÄÅÊÅêÁ´ú„Åå„ÅÑ„Å™„Åè„Å™„Çã„Åæ„Åß„ÄÅÈï∑„ÅÑÈñì‰∏ñÁïå‰∏≠„ÅÆÊµ∑„ÅßÁπÅÊ†Ñ„Åó„Å¶„ÅÑ„Åü„Çì„Å†„ÄÇÊÆª„ÅÆ‰∏≠„Å´„Ç¨„Çπ„ÇÑÊ∞¥„ÇíÂÖ•„Çå„Å¶„ÄÅÊµ∑„ÅÆ‰∏≠„Çí„Éï„ÉØ„Éï„ÉØ„Å®ÊºÇ„Å£„Å¶„ÅÑ„Åü„Å®ËÄÉ„Åà„Çâ„Çå„Å¶„ÅÑ„Çã„Çà„ÄÇ'
            }
        },
        { 
            id: 'spino', name: '„Çπ„Éî„Éé„Çµ„Ç¶„É´„Çπ', img: 'image/spinosaurus.jpg', // ‰øÆÊ≠£: image/
            hint: ['Ê∞¥Ëæ∫„ÅßÊöÆ„Çâ„Åó„Å¶„ÅÑ„Åü', 'ÊÅêÁ´ú„ÅÆÊ≠Ø‚Ä¶Ôºü'], 
            desc: ['„Äê„Çπ„Éî„Éé„Çµ„Ç¶„É´„Çπ„Äë', '„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË¶ã„Çã'],
            data: {
                nameOrigin: '„Éà„Ç≤„Éà„Ç≤„ÅÆ„Éà„Ç´„Ç≤',
                size: 'ÂÖ®Èï∑ 10 „Äú 18m',
                weight: '6 „Äú 9„Éà„É≥',
                class: 'Áç£ËÑöÈ°ûÔºàËÇâÈ£üÊÅêÁ´úÔºâ',
                era: 'ÁôΩ‰∫úÁ¥ÄÔºàÂâçÊúüÔºâ',
                origin: '„Ç®„Ç∏„Éó„Éà„ÄÅ„É¢„É≠„ÉÉ„Ç≥',
                longDesc: 'ËÉå‰∏≠„Å´„ÅÇ„ÇãÂ§ß„Åç„Å™„ÄåÂ∏Ü„Äç„ÅåÁâπÂæ¥ÁöÑ„Å™Â∑®Â§ß„Å™ËÇâÈ£üÊÅêÁ´ú„Å†„Çà„ÄÇ„ÉØ„Éã„ÅÆ„Çà„ÅÜ„Å´Âè£„ÅåÁ¥∞Èï∑„Åè„ÄÅÊ∞¥Ëæ∫„ÅßÈ≠ö„ÇíÊçï„Åæ„Åà„Å¶È£ü„Åπ„Å¶„ÅÑ„Åü„Å®ËÄÉ„Åà„Çâ„Çå„Å¶„ÅÑ„Çã„Çì„Å†„ÄÇÂè≤‰∏äÊúÄÂ§ßÁ¥ö„ÅÆËÇâÈ£üÊÅêÁ´ú„ÅÆ„Å≤„Å®„Å§„Å†„Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã„ÇàÔºÅ'
            }
        },
        { 
            id: 'trex', name: '„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ', img: 'image/tyrannosaurus.jpg', // ‰øÆÊ≠£: image/
            hint: ['ÊúÄÂº∑„ÅÆÊÅêÁ´ú„ÅÆ', '„Ç≠„Éê„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ‚Ä¶'], 
            desc: ['„Äê„ÉÜ„Ç£„É©„Éé„Çµ„Ç¶„É´„Çπ„Äë', '„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË¶ã„Çã'],
            data: {
                nameOrigin: 'Êö¥Âêõ„Éà„Ç´„Ç≤„ÅÆÁéã',
                size: 'ÂÖ®Èï∑ Á¥Ñ13m',
                weight: '6 „Äú 9„Éà„É≥',
                class: 'Áç£ËÑöÈ°ûÔºàËÇâÈ£üÊÅêÁ´úÔºâ',
                era: 'ÁôΩ‰∫úÁ¥ÄÔºàÂæåÊúüÔºâ',
                origin: '„Ç¢„É°„É™„Ç´„ÄÅ„Ç´„Éä„ÉÄ',
                longDesc: '„ÄåÊö¥Âêõ„Éà„Ç´„Ç≤„ÅÆÁéã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÅÆÂêçÂâç„ÇíÊåÅ„Å§„ÄÅ„ÇÇ„Å£„Å®„ÇÇÊúâÂêç„Å™ÊÅêÁ´ú„Å†„Å≠„ÄÇÂ§™„Åè„Å¶Èï∑„ÅÑÊ≠Ø„Å®„ÄÅ„Å®„Å¶„Å§„ÇÇ„Å™„ÅèÂº∑„ÅÑ„Ç¢„Ç¥„ÅÆÂäõ„Åß„ÄÅÁç≤Áâ©„ÅÆÈ™®„Åæ„ÅßÂôõ„ÅøÁ†ï„ÅÑ„Å¶„Åó„Åæ„Å£„Åü„Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã„Çà„ÄÇÂóÖË¶ö„ÇÇ„Å®„Å¶„ÇÇÂÑ™„Çå„Å¶„ÅÑ„Åü„Çì„Å†„ÄÇ'
            }
        },
        { 
            id: 'trilobite', name: '‰∏âËëâËô´', img: 'image/trilobite.jpg', // ‰øÆÊ≠£: image/
            hint: ['Êµ∑„ÅÆÂ∫ï„Çí', '„ÅØ„Å£„Å¶„ÅÑ„Åü„Çâ„Åó„ÅÑ‚Ä¶'], 
            desc: ['„Äê‰∏âËëâËô´„Äë', '„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË¶ã„Çã'],
            data: {
                nameOrigin: '3„Å§„ÅÆËëâÔºà„Åæ„ÅüÔºâ',
                size: 'Êï∞mm „Äú 70cm',
                weight: '„Å®„Å£„Å¶„ÇÇËªΩ„ÅÑ',
                class: 'ÁØÄË∂≥ÂãïÁâ©',
                era: '„Ç´„É≥„Éñ„É™„Ç¢Á¥Ä „Äú „Éö„É´„É†Á¥Ä',
                origin: '‰∏ñÁïå‰∏≠',
                longDesc: '‰ªä„ÅÆ„ÉÄ„É≥„Ç¥„É†„Ç∑„ÇÑ„Ç®„Éì„ÅÆÈÅ†„ÅÑË¶™Êàö„Å†„Çà„ÄÇ‰Ωì„Åå„ÄåÂ∑¶„ÉªÁúü„Çì‰∏≠„ÉªÂè≥„Äç„ÅÆ3„Å§„ÅÆÈÉ®ÂàÜ„Å´ÂàÜ„Åã„Çå„Å¶„ÅÑ„Çã„Åã„Çâ„Äå‰∏âËëâËô´„Äç„Å®Âëº„Å∞„Çå„Çã„Çì„Å†„ÄÇÊÅêÁ´ú„ÅåÁîü„Åæ„Çå„Çã„Çà„Çä„ÇÇ„Åö„Å£„Å®Êòî„ÅÆÊµ∑„Åß„ÄÅÂ§ßÁπÅÊ†Ñ„Åó„Å¶„ÅÑ„ÅüÁîü„ÅçÁâ©„Å†„Çà„ÄÇ'
            }
        },
        { 
            id: 'fukuiraptor', name: '„Éï„ÇØ„Ç§„É©„Éó„Éà„É´', img: 'image/fukuiraptor.jpg', // ‰øÆÊ≠£: image/
            hint: ['Êó•Êú¨„ÅßË¶ã„Å§„Åã„Å£„Åü', 'ËÇâÈ£üÊÅêÁ´ú„ÅÆ„ÉÑ„É°‚Ä¶Ôºü'], 
            desc: ['„Äê„Éï„ÇØ„Ç§„É©„Éó„Éà„É´„Äë', '„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË¶ã„Çã'],
            data: {
                nameOrigin: 'Á¶è‰∫ï„ÅÆÊ≥•Ê£í',
                size: 'ÂÖ®Èï∑ 4.2m',
                weight: 'Á¥Ñ300kg',
                class: 'Áç£ËÑöÈ°ûÔºà„É°„Ç¨„É©„Éó„Éà„É´È°û„Å®ËÄÉ„Åà„Çâ„Çå„Å¶„ÅÑ„ÇãÔºâ',
                era: 'ÁôΩ‰∫úÁ¥ÄÔºàÂâçÊúüÔºâ',
                origin: 'Êó•Êú¨ÔºàÁ¶è‰∫ïÁúåÔºâ',
                longDesc: 'Êó•Êú¨„ÅÆÁ¶è‰∫ïÁúåÂãùÂ±±Â∏Ç„ÅßÁô∫Ë¶ã„Åï„Çå„ÅüËÇâÈ£üÊÅêÁ´ú„Å†„ÇàÔºÅÂ§ß„Åç„Å™Êâã„ÅÆÁà™„ÅåÁâπÂæ¥„Å™„Çì„Å†„ÄÇ„Åì„Çå„Çí‰Ωø„Å£„Å¶Áç≤Áâ©„ÇíÊçï„Åæ„Åà„Å¶„ÅÑ„Åü„Å®ËÄÉ„Åà„Çâ„Çå„Å¶„ÅÑ„Çã„Çà„ÄÇÊó•Êú¨„Å´„ÇÇ„Åì„Çì„Å™„Å´„Åã„Å£„Åì„ÅÑ„ÅÑÊÅêÁ´ú„Åå„ÅÑ„Åü„Å™„Çì„Å¶„Åô„Åî„ÅÑ„Å≠ÔºÅ'
            }
        },
        { id: 'coming1', type: 'coming_soon' },
        { id: 'coming2', type: 'coming_soon' },
        { id: 'coming3', type: 'coming_soon' },
        { id: 'coming4', type: 'coming_soon' }
    ];

    /**
     * „Éá„Éº„ÇøÁÆ°ÁêÜ (State Management)
     * ‰∏çÊ≠£„Å™„Éá„Éº„Çø„Å´„Çà„Çã„ÇØ„É©„ÉÉ„Ç∑„É•„ÇíÈò≤„Åê„Éõ„ÉØ„Ç§„Éà„É™„Çπ„ÉàÊñπÂºè„ÇíÊé°Áî®
     */
    let unlockedStatus = { ammonite: false, spino: false, trex: false, trilobite: false, fukuiraptor: false };
    const SAVE_KEY = 'mechMechCollection_v2'; 

    function loadStatus() {
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (!saved) return;
            
            const data = JSON.parse(saved);
            if (typeof data !== 'object' || data === null) return;

            Object.keys(unlockedStatus).forEach(key => {
                if (typeof data[key] === 'boolean') {
                    unlockedStatus[key] = data[key];
                }
            });
        } catch (e) {
            console.warn('Save data corrupted, resetting.', e);
        }
    }
    loadStatus();

    function saveStatus() {
        localStorage.setItem(SAVE_KEY, JSON.stringify(unlockedStatus));
    }

    // --- DOMË¶ÅÁ¥†„ÅÆ„Ç≠„É£„ÉÉ„Ç∑„É• ---
    const ui = {
        grid: document.getElementById('grid-container'),
        detail: {
            section: document.getElementById('detail-section'),
            name: document.getElementById('dino-info-name'),
            img: document.getElementById('dino-info-img'),
            nameOrigin: document.getElementById('dino-info-name-origin'),
            size: document.getElementById('dino-info-size'),
            weight: document.getElementById('dino-info-weight'),
            class: document.getElementById('dino-info-class'),
            era: document.getElementById('dino-info-era'),
            origin: document.getElementById('dino-info-origin'),
            desc: document.getElementById('dino-info-desc')
        },
        audio: document.getElementById('sfx-sparkle')
    };

    /**
     * „Éò„É´„Éë„ÉºÈñ¢Êï∞: innerHTML„Çí‰Ωø„Çè„Åö„Å´ÊîπË°å‰ªò„Åç„ÉÜ„Ç≠„Çπ„Éà„ÇíË®≠ÂÆö
     */
    function setMultilineText(container, lines) {
        if (!container) return;
        container.textContent = ''; // „ÇØ„É™„Ç¢
        
        const lineArray = Array.isArray(lines) ? lines : [lines];

        lineArray.forEach((line, index) => {
            container.appendChild(document.createTextNode(line));
            if (index < lineArray.length - 1) {
                container.appendChild(document.createElement('br'));
            }
        });
    }

    // --- ÂàùÊúüÂåñÂá¶ÁêÜ ---
    
    // „Ç∞„É™„ÉÉ„Éâ„Ç¢„Ç§„ÉÜ„É†„ÅÆÁîüÊàê
    fossils.forEach(f => {
        const div = document.createElement('div');
        div.className = 'fossil-item';
        div.id = `item-${f.id}`;
        
        if (f.type === 'coming_soon') {
            div.classList.add('coming-soon');
            const textDiv = document.createElement('div');
            textDiv.className = 'coming-text';
            setMultilineText(textDiv, ['COMING', 'SOON', '...']);
            div.appendChild(textDiv);
        } else {
            // ÁîªÂÉè
            const img = document.createElement('img');
            img.src = f.img;
            img.className = 'fossil-img';
            img.alt = f.name;
            
            // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip-box';
            tooltip.id = `tooltip-${f.id}`;
            
            // ÂàùÊúüÁä∂ÊÖã„ÅÆÂà§ÂÆö
            if (unlockedStatus[f.id]) {
                div.classList.add('unlocked');
                setMultilineText(tooltip, f.desc);
            } else {
                div.classList.add('locked');
                setMultilineText(tooltip, f.hint);
            }
            
            div.appendChild(img);
            div.appendChild(tooltip);
            
            div.addEventListener('click', () => {
                if (unlockedStatus[f.id]) {
                    showDetails(f.id);
                } else {
                    div.style.transform = "translateX(5px)";
                    setTimeout(() => div.style.transform = "none", 100);
                }
            });
        }
        ui.grid.appendChild(div);
    });

    /**
     * UIÊìç‰Ωú (UI Logic)
     */
    function showDetails(id) {
        const data = fossils.find(f => f.id === id);
        if (!data) return;

        document.querySelectorAll('.fossil-item').forEach(el => el.classList.remove('selected'));
        const targetItem = document.getElementById(`item-${id}`);
        if(targetItem) targetItem.classList.add('selected');

        if(ui.detail.name) ui.detail.name.textContent = data.name;
        if(ui.detail.img) {
            ui.detail.img.src = data.img;
            ui.detail.img.alt = data.name;
        }
        
        if(ui.detail.nameOrigin) ui.detail.nameOrigin.textContent = data.data.nameOrigin;
        if(ui.detail.size) ui.detail.size.textContent = data.data.size;
        if(ui.detail.weight) ui.detail.weight.textContent = data.data.weight;
        if(ui.detail.class) ui.detail.class.textContent = data.data.class;
        if(ui.detail.era) ui.detail.era.textContent = data.data.era;
        if(ui.detail.origin) ui.detail.origin.textContent = data.data.origin;
        
        if(ui.detail.desc) ui.detail.desc.textContent = data.data.longDesc;

        ui.detail.section.style.display = 'block';
        setTimeout(() => {
            ui.detail.section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }

    // „Çπ„É†„Éº„Ç∫„Çπ„ÇØ„É≠„Éº„É´
    const scrollTopBtn = document.getElementById('scroll-top-btn');
    const topLogo = document.getElementById('top-logo');

    window.addEventListener('scroll', () => {
        if (!scrollTopBtn) return;
        if (window.scrollY > 200) { scrollTopBtn.classList.add('show'); }
        else { scrollTopBtn.classList.remove('show'); }
    });
    
    function scrollToTop(e) {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    if(scrollTopBtn) scrollTopBtn.addEventListener('click', scrollToTop);
    if(topLogo) topLogo.addEventListener('click', scrollToTop);

    // „Ç™„Éº„Éá„Ç£„Ç™ÂÜçÁîü„ÅÆÈÄ£ÊâìÂØæÁ≠ñ
    let isSoundPlaying = false;
    function playSparkleSound() {
        if (!ui.audio || isSoundPlaying) return;
        isSoundPlaying = true;
        ui.audio.currentTime = 0;
        ui.audio.volume = 1.0;
        ui.audio.play().catch(e => console.log('Audio error:', e));
        
        setTimeout(() => { isSoundPlaying = false; }, 300);
    }

    /**
     * „Éá„Éê„ÉÉ„Ç∞„ÉªÈñãÁô∫ËÄÖ„É¢„Éº„Éâ
     */
    let tapCount = 0;
    let tapTimer;
    const COPYRIGHT_TRIGGER = document.getElementById('copyright-trigger');
    const DEBUG_SECTION = document.getElementById('debug-section');
    const DEBUG_HANDLE = document.getElementById('debug-drag-handle');
    const DEBUG_KEY = 'mech_debug_mode_v1'; 

    if (localStorage.getItem(DEBUG_KEY) === 'true') {
        DEBUG_SECTION.style.display = 'block';
    }

    if(COPYRIGHT_TRIGGER) {
        COPYRIGHT_TRIGGER.addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => { tapCount = 0; }, 2000);
            const remaining = 7 - tapCount;
            if (remaining > 0 && remaining <= 5) {
                showToast(`ÈñãÁô∫ËÄÖ„É¢„Éº„Éâ„Åæ„Åß„ÅÇ„Å® ${remaining} Âõû„Åß„Åô`);
            }
            if (tapCount >= 7) {
                enableDebugMode();
                tapCount = 0;
            }
        });
    }

    function enableDebugMode() {
        if(!DEBUG_SECTION) return;
        DEBUG_SECTION.style.display = 'block';
        localStorage.setItem(DEBUG_KEY, 'true');
        showToast('ÈñãÁô∫ËÄÖ„É¢„Éº„Éâ„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ');
    }
    
    function disableDebugMode() {
        if(!DEBUG_SECTION) return;
        DEBUG_SECTION.style.display = 'none';
        localStorage.removeItem(DEBUG_KEY);
        showToast('ÈñãÁô∫ËÄÖ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü');
    }
    
    function resetCollection() {
        Object.keys(unlockedStatus).forEach(key => unlockedStatus[key] = false);
        localStorage.removeItem(SAVE_KEY); 

        fossils.forEach(f => {
            if (f.type === 'coming_soon') return;
            const item = document.getElementById(`item-${f.id}`);
            const tooltip = document.getElementById(`tooltip-${f.id}`);
            
            if(item) {
                item.classList.add('locked');
                item.classList.remove('unlocked', 'just-unlocked', 'selected');
            }
            setMultilineText(tooltip, f.hint);
        });
        ui.detail.section.style.display = 'none';
        showToast('Âõ≥Èëë„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
    }
    
    function showToast(message) {
        const toast = document.getElementById('toast');
        if(!toast) return;
        toast.innerText = message;
        toast.classList.add('show');
        setTimeout(() => { toast.classList.remove('show'); }, 2000);
    }

    function simulateNFC(id) {
        if (!fossils.find(f => f.id === id) || unlockedStatus[id]) return;
        unlockFossilEffect(id);
    }

    function unlockFossilEffect(id) {
        const item = document.getElementById(`item-${id}`);
        const data = fossils.find(f => f.id === id);
        
        playSparkleSound();

        unlockedStatus[id] = true;
        saveStatus();

        const tooltip = document.getElementById(`tooltip-${id}`);
        setMultilineText(tooltip, data.desc);
        
        if(item) {
            item.classList.remove('locked');
            item.classList.add('unlocked', 'just-unlocked');
            setTimeout(() => item.classList.remove('just-unlocked'), 600);
            createSparkles(item);
        }
    }

    function createSparkles(element) {
        for(let i=0; i<20; i++) {
            const sparkle = document.createElement('div');
            sparkle.classList.add('sparkle-particle');
            const angle = Math.random() * 360; 
            const distance = 60 + Math.random() * 80;
            const tx = Math.cos(angle * Math.PI / 180) * distance + 'px';
            const ty = Math.sin(angle * Math.PI / 180) * distance + 'px';
            sparkle.style.setProperty('--tx', tx);
            sparkle.style.setProperty('--ty', ty);
            sparkle.style.animationDelay = (Math.random() * 0.2) + 's';
            element.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1000);
        }
    }

    // --- „Éâ„É©„ÉÉ„Ç∞ÁßªÂãïÂá¶ÁêÜ ---
    let isDragging = false;
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;

    if (DEBUG_HANDLE) {
        DEBUG_HANDLE.addEventListener("mousedown", dragStart);
        document.addEventListener("mouseup", dragEnd);
        document.addEventListener("mousemove", drag);

        DEBUG_HANDLE.addEventListener("touchstart", dragStart, {passive: false});
        document.addEventListener("touchend", dragEnd);
        document.addEventListener("touchmove", drag, {passive: false});
    }

    function dragStart(e) {
        if (e.type === "touchstart") {
            initialX = e.touches[0].clientX - xOffset;
            initialY = e.touches[0].clientY - yOffset;
        } else {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
        }

        if (e.target === DEBUG_HANDLE) {
            isDragging = true;
        }
    }

    function dragEnd(e) {
        initialX = currentX;
        initialY = currentY;
        isDragging = false;
    }

    function drag(e) {
        if (isDragging) {
            e.preventDefault();
            if (e.type === "touchmove") {
                currentX = e.touches[0].clientX - initialX;
                currentY = e.touches[0].clientY - initialY;
            } else {
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
            }

            xOffset = currentX;
            yOffset = currentY;

            if(DEBUG_SECTION) {
                DEBUG_SECTION.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
            }
        }
    }
</script>

</body>
</html>
